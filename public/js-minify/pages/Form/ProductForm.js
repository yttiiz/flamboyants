var d=class{createHTMLElements(...e){let o=[];for(let t of e)o.push(document.createElement(t));return o}createSameHTMLElements(e,o){let t=[];for(let s=0;s<o;s++)t.push(document.createElement(e));return t}setSameHTMLElementAttributes(e,o,...t){if(t.length===1){o===!0?t[0].setAttribute(e,""):t[0][e]=o;return}for(let s of t)o===!0?s.setAttribute(e,""):s[e]=o}insertChildren(e,...o){for(let t of o)e.appendChild(t)}};var g=r=>{let e=new FormData(r);for(let[o,t]of e)(t===""||typeof t=="object"&&t.size===0||o.includes("file"))&&e.delete(o);return e},m=r=>{for(let e of r)e.querySelector("textarea")&&(e.querySelector("textarea").value=""),e.querySelector("input")&&(e.querySelector("input").value="")},y=class{constructor(){}static setFormData=g;static removeInputsValues=m;static setUserDialogContent=(r,{title:e,paragraph:o})=>{r.querySelector("h2").textContent=e,r.querySelector("p").textContent=o};static setProductDialogContent=(r,{isUserConnected:e,title:o,paragraph:t})=>{r.querySelector("h2").textContent=o,r.querySelector("p").textContent=t,e||e===void 0?r.querySelector(".login-register").classList.contains("none")||r.querySelector(".login-register").classList.add("none"):r.querySelector(".login-register").classList.contains("none")&&r.querySelector(".login-register").classList.remove("none")};static setProfilDialogContent=(r,{title:e,paragraph:o,status:t,handler:s})=>{if(r.querySelector("h2").textContent=e,r.querySelector("p").textContent=o,t)switch(t){case 201:{r.querySelector("form").classList.contains("none")||r.querySelector("form").classList.add("none");break}case 200:{r.querySelector("form").classList.contains("none")||r.querySelector("form").classList.add("none"),r.querySelector(".show-message-to-user").classList.contains("none")&&r.querySelector(".show-message-to-user").classList.remove("none"),s&&(r.querySelector("button").removeEventListener("click",s),r.querySelector("button").addEventListener("click",()=>globalThis.location.href="/"));break}}else r.querySelector("form").classList.contains("none")&&r.querySelector("form").classList.remove("none")};static setHomeDialogContent=(r,{title:e,paragraph:o},t)=>{r.querySelector("h2").textContent=e,r.querySelector("p").innerHTML=o;let s=globalThis.navigator.userAgent.includes("Firefox"),l=r.querySelector("input"),a=t.closest("div").nextElementSibling.href;if(l.value=a,s){let n=r.querySelector("div > div"),c=n.querySelector("button");c&&n.removeChild(c);return}r.querySelector("div > div button").addEventListener("click",async n=>{let c=await navigator.permissions.query({name:"clipboard-write"});(c.state==="granted"||c.state==="prompt")&&(navigator.clipboard.writeText(a),l.select(),n.target.textContent="Copi\xE9",setTimeout(()=>{globalThis.getSelection().removeAllRanges(),n.target.textContent="Copier"},2e3))})};static getOrCreateElement=({parent:r,cssSelector:e,hmtlTag:o})=>{let t;return r.querySelector(e)?t=r.querySelector(e):(t=document.createElement(o),r.appendChild(t)),t}},i=class u extends y{static getClassName=e=>`#data-product .${e}`;static displayDialogUserReviewDetails=async e=>{let o=e.status,{message:t}=await e.json(),s=document.querySelector("#data-product > dialog");u.setProductDialogContent(s,{title:"F\xE9licitations",paragraph:t,status:o}),s.showModal()};static displayDialogUserBookingDetails=async e=>{let{title:o,message:t,booking:s,email:l}=await e.json(),a=t.replace("{{ start }}",s.start).replace("{{ end }}",s.end);l&&(a=a.replace("{{ email }}",l));let n=document.querySelector("#data-product > dialog");u.setProductDialogContent(n,{title:o,paragraph:a}),n.showModal()};static displayDialogLoginInfoToUser=e=>{let o=document.querySelector("#data-product > dialog");u.setProductDialogContent(o,{isUserConnected:e,title:"Connectez-vous !",paragraph:"Vous devez vous connecter pour pouvoir r\xE9server un cr\xE9neau !"}),o.showModal()};static displayDialogErrorInfoToUser=async e=>{let{message:o}=await e.json(),t=document.querySelector("#data-product > dialog");u.setProductDialogContent(t,{title:"Erreur de saisie",paragraph:o}),t.showModal()}};var p=class extends d{initForm=()=>{let e="#data-product";this.#e();let o=document.querySelectorAll(`${e} form`),t=document.querySelector(`${e} dialog`);for(let a of o)a.addEventListener("submit",n=>this.#r(n));t.querySelector("button[data-close]").addEventListener("click",()=>{t.close()});let[s,l]=o;this.#t(s),l&&this.#o(l)};#e=()=>{let e=document.querySelector("h1")?.textContent?.split(" ")[1].toLowerCase();document.querySelector(".header-"+e).addEventListener("click",t=>t.preventDefault())};#t=e=>{let[o,t]=e.querySelectorAll('input[type="date"]');o.addEventListener("change",s=>{t.min=s.target.value})};#o=e=>{for(let o of e.querySelectorAll("input"))o.addEventListener("click",t=>{let s=t.currentTarget.previousElementSibling,l=t.currentTarget.closest("div");s.classList.contains("selected")||s.classList.add("selected");for(let a of l.querySelectorAll("label")){let n=a.querySelector("span");n.classList.contains("selected")&&s.textContent!==n.textContent&&n.classList.remove("selected")}})};#r=async e=>{e.preventDefault();let o=i.setFormData(e.target),t=location.pathname.replace("/product/",""),l=e.target.action.replace(location.origin+"/","")==="booking";if(l){let n=e.target.dataset.userConnected==="true";if(!n){i.displayDialogLoginInfoToUser(n);return}}o.append("id",t);let a=await fetch(e.target.action,{method:"POST",body:o,headers:{"Access-Control-Allow-Origin":"*"},mode:"cors"});a.ok?(i.removeInputsValues(e.target.children),l?i.displayDialogUserBookingDetails(a):i.displayDialogUserReviewDetails(a)):a.status===401&&i.displayDialogErrorInfoToUser(a)}};export{p as ProductFormPage};
