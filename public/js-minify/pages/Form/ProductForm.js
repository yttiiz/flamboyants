var d=class{createHTMLElements(...e){let t=[];for(let o of e)t.push(document.createElement(o));return t}createSameHTMLElements(e,t){let o=[];for(let r=0;r<t;r++)o.push(document.createElement(e));return o}setSameHTMLElementAttributes(e,t,...o){if(o.length===1){t===!0?o[0].setAttribute(e,""):o[0][e]=t;return}for(let r of o)t===!0?r.setAttribute(e,""):r[e]=t}insertChildren(e,...t){for(let o of t)e.appendChild(o)}};var m=c=>{let e=new FormData(c);for(let[t,o]of e)(o===""||typeof o=="object"&&o.size===0||t.includes("file"))&&e.delete(t);return e},g=c=>{for(let e of c)e.querySelector("textarea")&&(e.querySelector("textarea").value=""),e.querySelector("input")&&(e.querySelector("input").value="")};var p=class{constructor(){}static setFormData=m;static removeInputsValues=g;static setUserDialogContent=(e,{title:t,paragraph:o})=>{e.querySelector("h2").textContent=t,e.querySelector("p").textContent=o};static setProductDialogContent=(e,{isUserConnected:t,title:o,paragraph:r})=>{e.querySelector("h2").textContent=o,e.querySelector("p").textContent=r,t||t===void 0?e.querySelector(".login-register").classList.contains("none")||e.querySelector(".login-register").classList.add("none"):e.querySelector(".login-register").classList.contains("none")&&e.querySelector(".login-register").classList.remove("none")};static setProfilDialogContent=(e,{title:t,paragraph:o,status:r,handler:s})=>{if(e.querySelector("h2").textContent=t,e.querySelector("p").textContent=o,r)switch(r){case 201:{e.querySelector("form").classList.contains("none")||e.querySelector("form").classList.add("none");break}case 200:{e.querySelector("form").classList.contains("none")||e.querySelector("form").classList.add("none"),e.querySelector(".show-message-to-user").classList.contains("none")&&e.querySelector(".show-message-to-user").classList.remove("none"),s&&(e.querySelector("button").removeEventListener("click",s),e.querySelector("button").addEventListener("click",()=>globalThis.location.href="/"));break}}else e.querySelector("form").classList.contains("none")&&e.querySelector("form").classList.remove("none")};static setHomeDialogContent=(e,{title:t,paragraph:o},r)=>{e.querySelector("h2").textContent=t,e.querySelector("p").innerHTML=o;let s=globalThis.navigator.userAgent.includes("Firefox"),n=e.querySelector("input"),a=r.closest("div").nextElementSibling.href;if(n.value=a,s){let l=e.querySelector("div > div"),u=l.querySelector("button");u&&l.removeChild(u);return}e.querySelector("div > div button").addEventListener("click",async l=>{let u=await navigator.permissions.query({name:"clipboard-write"});(u.state==="granted"||u.state==="prompt")&&(navigator.clipboard.writeText(a),n.select(),l.target.textContent="Copi\xE9",setTimeout(()=>{globalThis.getSelection().removeAllRanges(),l.target.textContent="Copier"},2e3))})};static getOrCreateElement=({parent:e,cssSelector:t,hmtlTag:o})=>{let r;return e.querySelector(t)?r=e.querySelector(t):(r=document.createElement(o),e.appendChild(r)),r}};var i=class c extends p{static getClassName=e=>`#data-product .${e}`;static displayDialogUserReviewDetails=async e=>{let t=e.status,{message:o}=await e.json(),r=document.querySelector("#data-product > dialog");c.setProductDialogContent(r,{title:"F\xE9licitations",paragraph:o,status:t}),r.showModal()};static displayDialogUserBookingDetails=async e=>{let{title:t,message:o,booking:r,email:s}=await e.json(),n=o.replace("{{ start }}",r.start).replace("{{ end }}",r.end);s&&(n=n.replace("{{ email }}",s));let a=document.querySelector("#data-product > dialog");c.setProductDialogContent(a,{title:t,paragraph:n}),a.showModal()};static displayDialogLoginInfoToUser=e=>{let t=document.querySelector("#data-product > dialog");c.setProductDialogContent(t,{isUserConnected:e,title:"Connectez-vous !",paragraph:"Vous devez vous connecter pour pouvoir r\xE9server un cr\xE9neau !"}),t.showModal()};static displayDialogErrorInfoToUser=async e=>{let{message:t}=await e.json(),o=document.querySelector("#data-product > dialog");c.setProductDialogContent(o,{title:"Erreur de saisie",paragraph:t}),o.showModal()}};var f=class extends d{initForm=()=>{let e="#data-product";this.#e();let t=document.querySelectorAll(`${e} form`),o=document.querySelector(`${e} dialog`);for(let n of t)n.addEventListener("submit",a=>this.#r(a));o.querySelector("button[data-close]").addEventListener("click",()=>{o.close()});let[r,s]=t;this.#t(r),s&&this.#o(s)};#e=()=>{let e=document.querySelector("h1")?.textContent?.split(" ")[1].toLowerCase();document.querySelector(".header-"+e).addEventListener("click",o=>o.preventDefault())};#t=e=>{let[t,o]=e.querySelectorAll('input[type="date"]');t.addEventListener("change",r=>{o.min=r.target.value})};#o=e=>{for(let t of e.querySelectorAll("input"))t.addEventListener("click",o=>{let r=o.currentTarget.previousElementSibling,s=o.currentTarget.closest("div");r.classList.contains("selected")||r.classList.add("selected");for(let n of s.querySelectorAll("label")){let a=n.querySelector("span");a.classList.contains("selected")&&r.textContent!==a.textContent&&a.classList.remove("selected")}})};#r=async e=>{e.preventDefault();let t=i.setFormData(e.target),o=location.pathname.replace("/product/",""),s=e.target.action.replace(location.origin+"/","")==="booking";if(s){let a=e.target.dataset.userConnected==="true";if(!a){i.displayDialogLoginInfoToUser(a);return}}t.append("id",o);let n=await fetch(e.target.action,{method:"POST",body:t,headers:{"Access-Control-Allow-Origin":"*"},mode:"cors"});n.ok?(i.removeInputsValues(e.target.children),s?i.displayDialogUserBookingDetails(n):i.displayDialogUserReviewDetails(n)):n.status===401&&i.displayDialogErrorInfoToUser(n)}};export{f as ProductFormPage};
