var m=(r,e)=>{let t,o,s=(a,i="photo")=>(a=document.createElement("input"),a.type="file",a.name=i,a.accept=".png, .jpg, .webp, .jpeg",a),n=(a,i)=>{a.addEventListener("change",c=>{if(c.currentTarget.files.length===1){let{name:l,size:h}=c.currentTarget.files[0],p=new Intl.NumberFormat("fr-FR",{maximumFractionDigits:2}).format(h/1e3);i instanceof HTMLDivElement?(i.innerHTML=`Fichier choisi : <b>${l}</b> (taille: ${p} ko).`,i.classList.contains("none")&&(i.classList.remove("none"),i.classList.add("show-file"))):i.value=`${l} (taille: ${p} ko)`}})};r.currentTarget.closest("form").action.includes("/profil")?o=r.currentTarget.nextElementSibling:o=r.currentTarget.closest("div").previousElementSibling,r.currentTarget.parentNode.querySelector("input")?t=r.currentTarget.parentNode.querySelector("input"):(t=e?s(t,e):s(t),r.currentTarget.closest("div").insertBefore(t,r.currentTarget),n(t,o)),t.click()},g=r=>{let e=new FormData(r);for(let[t,o]of e)(o===""||typeof o=="object"&&o.size===0||t.includes("file"))&&e.delete(t);return e},y=r=>{for(let e of r)e.querySelector("textarea")&&(e.querySelector("textarea").value=""),e.querySelector("input")&&(e.querySelector("input").value="")},f=(r,e)=>{let t=typeof e[r.name]=="string"||typeof e[r.name]=="number";r.type!=="password"&&t&&(r.type==="date"?r.value=e[r.name].split("T").at(0):r.value=e[r.name])};var d=()=>"?apiKey=ESdv9jDqQGsuL9XEsqlS6KWN";var u=class{constructor(){}static setFormData=g;static removeInputsValues=y;static setUserDialogContent=(e,{title:t,paragraph:o})=>{e.querySelector("h2").textContent=t,e.querySelector("p").textContent=o};static setProductDialogContent=(e,{isUserConnected:t,title:o,paragraph:s})=>{e.querySelector("h2").textContent=o,e.querySelector("p").textContent=s,t||t===void 0?e.querySelector(".login-register").classList.contains("none")||e.querySelector(".login-register").classList.add("none"):e.querySelector(".login-register").classList.contains("none")&&e.querySelector(".login-register").classList.remove("none")};static setProfilDialogContent=(e,{title:t,paragraph:o,status:s,handler:n})=>{if(e.querySelector("h2").textContent=t,e.querySelector("p").textContent=o,s)switch(s){case 201:{e.querySelector("form").classList.contains("none")||e.querySelector("form").classList.add("none");break}case 200:{e.querySelector("form").classList.contains("none")||e.querySelector("form").classList.add("none"),e.querySelector(".show-message-to-user").classList.contains("none")&&e.querySelector(".show-message-to-user").classList.remove("none"),n&&(e.querySelector("button").removeEventListener("click",n),e.querySelector("button").addEventListener("click",()=>globalThis.location.href="/"));break}}else e.querySelector("form").classList.contains("none")&&e.querySelector("form").classList.remove("none")};static setHomeDialogContent=(e,{title:t,paragraph:o},s)=>{e.querySelector("h2").textContent=t,e.querySelector("p").innerHTML=o;let n=globalThis.navigator.userAgent.includes("Firefox"),a=e.querySelector("input"),i=s.closest("div").nextElementSibling.href;if(a.value=i,n){let c=e.querySelector("div > div"),l=c.querySelector("button");l&&c.removeChild(l);return}e.querySelector("div > div button").addEventListener("click",async c=>{let l=await navigator.permissions.query({name:"clipboard-write"});(l.state==="granted"||l.state==="prompt")&&(navigator.clipboard.writeText(i),a.select(),c.target.textContent="Copi\xE9",setTimeout(()=>{globalThis.getSelection().removeAllRanges(),c.target.textContent="Copier"},2e3))})};static getOrCreateElement=({parent:e,cssSelector:t,hmtlTag:o})=>{let s;return e.querySelector(t)?s=e.querySelector(t):(s=document.createElement(o),e.appendChild(s)),s}};var S=class r extends u{static id=e=>`#data-${e}-form`;static handleInputFile=m;static hydrateInput=f;static displayDialogRegisterDetails=async e=>{let{message:t,title:o}=await e.json(),s=document.querySelector("#data-user-form > dialog");r.setUserDialogContent(s,{title:o,paragraph:t}),s.showModal()};static displayDialogforgotPassword=()=>{let e=document.querySelector("dialog[data-reset-password]");e.querySelector("h2").textContent||r.setUserDialogContent(e,{title:"Mot de passe oubli\xE9 ?",paragraph:"Saisissez votre adresse e-mail et nous vous enverrons des instructions pour r\xE9initialiser votre mot de passe."}),e.showModal()};static sendNewPasswordToUser=async e=>{let t=e.currentTarget.previousElementSibling,o=t.querySelector("input")?.value.trim();if(o)try{let s=await fetch("/get-user-firstname"+d(),{method:"POST",body:JSON.stringify({email:o})});if(s.ok&&s.status===200){let{firstname:n}=await s.json(),a=await fetch("/send-forgot-password-email"+d(),{method:"POST",body:JSON.stringify({firstname:n,email:o})});if(a.ok){let{message:i}=await a.json();r.displaySendForgotPasswordEmailMessage(t,i)}}}catch(s){console.log(s)}else if(!t.querySelector("p")){let s=document.createElement("p");s.textContent="Veuillez renseigner une adresse email !",s.style.color="red",t.appendChild(s)}};static showLoginError=async e=>{let{message:t}=await e.json(),o=document.querySelector("form > span");o.textContent=t,o.classList.contains("none")&&o.classList.remove("none")};static displaySendForgotPasswordEmailMessage=(e,t)=>{let o=e.closest(".send-user-email"),s=o.closest("dialog").querySelector("p");o.innerHTML="",s.innerHTML=t};static displayDialogToDeleteAccount=()=>{let e=document.querySelector("#data-profil-form > dialog");r.setProfilDialogContent(e,{title:"Suppression du compte",paragraph:"Etes-vous vraiment s\xFBr de vouloir supprimer votre compte ?"}),e.showModal()};static displayDialogProfilUpdatedDetails=async e=>{let t="#data-profil-form",o=e.status,{message:s,photo:n}=await e.json(),a=document.querySelector(t+" > dialog");n&&(document.querySelector(t+" figure > img").src=n,document.querySelector(".user-photo > div").classList.add("none")),r.setProfilDialogContent(a,{title:"Mise \xE0 jour",paragraph:s,status:o}),a.showModal()};static displayDialogProfilDeletedDetails=async(e,t)=>{let o=e.status,{message:s}=await e.json(),n=document.querySelector("#data-profil-form > dialog");r.setProfilDialogContent(n,{title:"Compte supprim\xE9",paragraph:s,status:o,handler:t})};static showErrorMsg=async(e,t)=>{let o=e.status,s=t==="/profil"?"profil":"user",{errorMsg:n}=await e.json();r.#e({msg:n+o,dataSet:"error"},s)};static#e=({msg:e,dataSet:t},o)=>{let s=document.querySelector(r.id(o)+" .container"),n=r.getOrCreateElement({parent:s,cssSelector:"p[data-msg-infos]",hmtlTag:"p"});n.dataset.msgInfos=t,n.textContent=e}};export{S as UserFormHelper};
