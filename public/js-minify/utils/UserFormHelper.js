var g=(t,e)=>{let r,o,s=(a,i="photo")=>(a=document.createElement("input"),a.type="file",a.name=i,a.accept=".png, .jpg, .webp, .jpeg",a),n=(a,i)=>{a.addEventListener("change",l=>{if(l.currentTarget.files.length===1){let{name:u,size:m}=l.currentTarget.files[0],p=new Intl.NumberFormat("fr-FR",{maximumFractionDigits:2}).format(m/1e3);i instanceof HTMLDivElement?(i.innerHTML=`Fichier choisi : <b>${u}</b> (taille: ${p} ko).`,i.classList.contains("none")&&(i.classList.remove("none"),i.classList.add("show-file"))):i.value=`${u} (taille: ${p} ko)`}})};t.currentTarget.closest("form").action.includes("/profil")?o=t.currentTarget.nextElementSibling:o=t.currentTarget.closest("div").previousElementSibling,t.currentTarget.parentNode.querySelector("input")?r=t.currentTarget.parentNode.querySelector("input"):(r=e?s(r,e):s(r),t.currentTarget.closest("div").insertBefore(r,t.currentTarget),n(r,o)),r.click()},f=t=>{let e=new FormData(t);for(let[r,o]of e)(o===""||typeof o=="object"&&o.size===0||r.includes("file"))&&e.delete(r);return e},y=t=>{for(let e of t)e.querySelector("textarea")&&(e.querySelector("textarea").value=""),e.querySelector("input")&&(e.querySelector("input").value="")},S=(t,e)=>{let r=typeof e[t.name]=="string"||typeof e[t.name]=="number";t.type!=="password"&&r&&(t.type==="date"?t.value=e[t.name].split("T").at(0):t.value=e[t.name])},d=()=>"?apiKey=ESdv9jDqQGsuL9XEsqlS6KWN",v=class{constructor(){}static setFormData=f;static removeInputsValues=y;static setUserDialogContent=(t,{title:e,paragraph:r})=>{t.querySelector("h2").textContent=e,t.querySelector("p").textContent=r};static setProductDialogContent=(t,{isUserConnected:e,title:r,paragraph:o})=>{t.querySelector("h2").textContent=r,t.querySelector("p").textContent=o,e||e===void 0?t.querySelector(".login-register").classList.contains("none")||t.querySelector(".login-register").classList.add("none"):t.querySelector(".login-register").classList.contains("none")&&t.querySelector(".login-register").classList.remove("none")};static setProfilDialogContent=(t,{title:e,paragraph:r,status:o,handler:s})=>{if(t.querySelector("h2").textContent=e,t.querySelector("p").textContent=r,o)switch(o){case 201:{t.querySelector("form").classList.contains("none")||t.querySelector("form").classList.add("none");break}case 200:{t.querySelector("form").classList.contains("none")||t.querySelector("form").classList.add("none"),t.querySelector(".show-message-to-user").classList.contains("none")&&t.querySelector(".show-message-to-user").classList.remove("none"),s&&(t.querySelector("button").removeEventListener("click",s),t.querySelector("button").addEventListener("click",()=>globalThis.location.href="/"));break}}else t.querySelector("form").classList.contains("none")&&t.querySelector("form").classList.remove("none")};static setHomeDialogContent=(t,{title:e,paragraph:r},o)=>{t.querySelector("h2").textContent=e,t.querySelector("p").innerHTML=r;let s=globalThis.navigator.userAgent.includes("Firefox"),n=t.querySelector("input"),a=o.closest("div").nextElementSibling.href;if(n.value=a,s){let i=t.querySelector("div > div"),l=i.querySelector("button");l&&i.removeChild(l);return}t.querySelector("div > div button").addEventListener("click",async i=>{let l=await navigator.permissions.query({name:"clipboard-write"});(l.state==="granted"||l.state==="prompt")&&(navigator.clipboard.writeText(a),n.select(),i.target.textContent="Copi\xE9",setTimeout(()=>{globalThis.getSelection().removeAllRanges(),i.target.textContent="Copier"},2e3))})};static getOrCreateElement=({parent:t,cssSelector:e,hmtlTag:r})=>{let o;return t.querySelector(e)?o=t.querySelector(e):(o=document.createElement(r),t.appendChild(o)),o}},q=class c extends v{static id=e=>`#data-${e}-form`;static handleInputFile=g;static hydrateInput=S;static displayDialogRegisterDetails=async e=>{let{message:r,title:o}=await e.json(),s=document.querySelector("#data-user-form > dialog");c.setUserDialogContent(s,{title:o,paragraph:r}),s.showModal()};static displayDialogforgotPassword=()=>{let e=document.querySelector("dialog[data-reset-password]");e.querySelector("h2").textContent||c.setUserDialogContent(e,{title:"Mot de passe oubli\xE9 ?",paragraph:"Saisissez votre adresse e-mail et nous vous enverrons des instructions pour r\xE9initialiser votre mot de passe."}),e.showModal()};static sendNewPasswordToUser=async e=>{let r=e.currentTarget.previousElementSibling,o=r.querySelector("input")?.value.trim();if(o)try{let s=await fetch("/get-user-firstname"+d(),{method:"POST",body:JSON.stringify({email:o})});if(s.ok&&s.status===200){let{firstname:n}=await s.json(),a=await fetch("/send-forgot-password-email"+d(),{method:"POST",body:JSON.stringify({firstname:n,email:o})});if(a.ok){let{message:i}=await a.json();c.displaySendForgotPasswordEmailMessage(r,i)}}}catch(s){console.log(s)}else if(!r.querySelector("p")){let s=document.createElement("p");s.textContent="Veuillez renseigner une adresse email !",s.style.color="red",r.appendChild(s)}};static showLoginError=async e=>{let{message:r}=await e.json(),o=document.querySelector("form > span");o.textContent=r,o.classList.contains("none")&&o.classList.remove("none")};static displaySendForgotPasswordEmailMessage=(e,r)=>{let o=e.closest(".send-user-email"),s=o.closest("dialog").querySelector("p");o.innerHTML="",s.innerHTML=r};static displayDialogToDeleteAccount=()=>{let e=document.querySelector("#data-profil-form > dialog");c.setProfilDialogContent(e,{title:"Suppression du compte",paragraph:"Etes-vous vraiment s\xFBr de vouloir supprimer votre compte ?"}),e.showModal()};static displayDialogProfilUpdatedDetails=async e=>{let r="#data-profil-form",o=e.status,{message:s,photo:n}=await e.json(),a=document.querySelector(r+" > dialog");n&&(document.querySelector(r+" figure > img").src=n,document.querySelector(".user-photo > div").classList.add("none")),c.setProfilDialogContent(a,{title:"Mise \xE0 jour",paragraph:s,status:o}),a.showModal()};static displayDialogProfilDeletedDetails=async(e,r)=>{let o=e.status,{message:s}=await e.json(),n=document.querySelector("#data-profil-form > dialog");c.setProfilDialogContent(n,{title:"Compte supprim\xE9",paragraph:s,status:o,handler:r})};static showErrorMsg=async(e,r)=>{let o=e.status,s=r==="/profil"?"profil":"user",{errorMsg:n}=await e.json();c.#e({msg:n+o,dataSet:"error"},s)};static#e=({msg:e,dataSet:r},o)=>{let s=document.querySelector(c.id(o)+" .container"),n=c.getOrCreateElement({parent:s,cssSelector:"p[data-msg-infos]",hmtlTag:"p"});n.dataset.msgInfos=r,n.textContent=e}};export{q as UserFormHelper};
