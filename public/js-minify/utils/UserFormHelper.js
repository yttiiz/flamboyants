var m=(s,e)=>{let t,r,o=(a,i="photo")=>(a=document.createElement("input"),a.type="file",a.name=i,a.accept=".png, .jpg, .webp, .jpeg",a),n=(a,i)=>{a.addEventListener("change",c=>{if(c.currentTarget.files.length===1){let{name:l,size:h}=c.currentTarget.files[0],p=new Intl.NumberFormat("fr-FR",{maximumFractionDigits:2}).format(h/1e3);i instanceof HTMLDivElement?(i.innerHTML=`Fichier choisi : <b>${l}</b> (taille: ${p} ko).`,i.classList.contains("none")&&(i.classList.remove("none"),i.classList.add("show-file"))):i.value=`${l} (taille: ${p} ko)`}})};s.currentTarget.closest("form").action.includes("/profil")?r=s.currentTarget.nextElementSibling:r=s.currentTarget.closest("div").previousElementSibling,s.currentTarget.parentNode.querySelector("input")?t=s.currentTarget.parentNode.querySelector("input"):(t=e?o(t,e):o(t),s.currentTarget.closest("div").insertBefore(t,s.currentTarget),n(t,r)),t.click()},g=s=>{let e=new FormData(s);for(let[t,r]of e)(r===""||typeof r=="object"&&r.size===0||t.includes("file"))&&e.delete(t);return e},y=s=>{for(let e of s)e.querySelector("textarea")&&(e.querySelector("textarea").value=""),e.querySelector("input")&&(e.querySelector("input").value="")},f=(s,e)=>{let t=typeof e[s.name]=="string"||typeof e[s.name]=="number";s.type!=="password"&&t&&(s.type==="date"?s.value=e[s.name].split("T").at(0):s.value=e[s.name])};var d=()=>"?apiKey=ESdv9jDqQGsuL9XEsqlS6KWN";var u=class{constructor(){}static setFormData=g;static removeInputsValues=y;static setUserDialogContent=(e,{title:t,paragraph:r})=>{e.querySelector("h2").textContent=t,e.querySelector("p").innerHTML=r};static setProductDialogContent=(e,{isUserConnected:t,title:r,paragraph:o})=>{e.querySelector("h2").textContent=r,e.querySelector("p").textContent=o,t||t===void 0?e.querySelector(".login-register").classList.contains("none")||e.querySelector(".login-register").classList.add("none"):e.querySelector(".login-register").classList.contains("none")&&e.querySelector(".login-register").classList.remove("none")};static setProfilDialogContent=(e,{title:t,paragraph:r,status:o,handler:n})=>{if(e.querySelector("h2").textContent=t,e.querySelector("p").textContent=r,o)switch(o){case 201:{e.querySelector("form").classList.contains("none")||e.querySelector("form").classList.add("none");break}case 200:{e.querySelector("form").classList.contains("none")||e.querySelector("form").classList.add("none"),e.querySelector(".show-message-to-user").classList.contains("none")&&e.querySelector(".show-message-to-user").classList.remove("none"),n&&(e.querySelector("button").removeEventListener("click",n),e.querySelector("button").addEventListener("click",()=>globalThis.location.href="/"));break}}else e.querySelector("form").classList.contains("none")&&e.querySelector("form").classList.remove("none")};static setHomeDialogContent=(e,{title:t,paragraph:r},o)=>{e.querySelector("h2").textContent=t,e.querySelector("p").innerHTML=r;let n=globalThis.navigator.userAgent.includes("Firefox"),a=e.querySelector("input"),i=o.closest("div").nextElementSibling.href;if(a.value=i,n){let c=e.querySelector("div > div"),l=c.querySelector("button");l&&c.removeChild(l);return}e.querySelector("div > div button").addEventListener("click",async c=>{let l=await navigator.permissions.query({name:"clipboard-write"});(l.state==="granted"||l.state==="prompt")&&(navigator.clipboard.writeText(i),a.select(),c.target.textContent="Copi\xE9",setTimeout(()=>{globalThis.getSelection().removeAllRanges(),c.target.textContent="Copier"},2e3))})};static getOrCreateElement=({parent:e,cssSelector:t,hmtlTag:r})=>{let o;return e.querySelector(t)?o=e.querySelector(t):(o=document.createElement(r),e.appendChild(o)),o}};var S=class s extends u{static id=e=>`#data-${e}-form`;static handleInputFile=m;static hydrateInput=f;static displayDialogRegisterDetails=async e=>{let{message:t,title:r}=await e.json(),o=document.querySelector("#data-user-form > dialog");e.status<300&&o.querySelector("button[data-close]").addEventListener("click",()=>location.href="/"),s.setUserDialogContent(o,{title:r,paragraph:t}),o.showModal()};static displayDialogforgotPassword=()=>{let e=document.querySelector("dialog[data-reset-password]");e.querySelector("h2").textContent||s.setUserDialogContent(e,{title:"Mot de passe oubli\xE9 ?",paragraph:"Saisissez votre adresse e-mail et nous vous enverrons des instructions pour r\xE9initialiser votre mot de passe."}),e.showModal()};static sendNewPasswordToUser=async e=>{let t=e.currentTarget.previousElementSibling,r=t.querySelector("input")?.value.trim();if(r)try{let o=await fetch("/get-user-firstname"+d(),{method:"POST",body:JSON.stringify({email:r})});if(o.ok&&o.status===200){let{firstname:n}=await o.json(),a=await fetch("/send-forgot-password-email"+d(),{method:"POST",body:JSON.stringify({firstname:n,email:r})});if(a.ok){let{message:i}=await a.json();s.displaySendForgotPasswordEmailMessage(t,i)}}}catch(o){console.log(o)}else if(!t.querySelector("p")){let o=document.createElement("p");o.textContent="Veuillez renseigner une adresse email !",o.style.color="red",t.appendChild(o)}};static showLoginError=async e=>{let{message:t}=await e.json(),r=document.querySelector("form > span");r.textContent=t,r.classList.contains("none")&&r.classList.remove("none")};static displaySendForgotPasswordEmailMessage=(e,t)=>{let r=e.closest(".send-user-email"),o=r.closest("dialog").querySelector("p");r.innerHTML="",o.innerHTML=t};static displayDialogToDeleteAccount=()=>{let e=document.querySelector("#data-profil-form > dialog");s.setProfilDialogContent(e,{title:"Suppression du compte",paragraph:"Etes-vous vraiment s\xFBr de vouloir supprimer votre compte ?"}),e.showModal()};static displayDialogProfilUpdatedDetails=async e=>{let t="#data-profil-form",r=e.status,{message:o,photo:n}=await e.json(),a=document.querySelector(t+" > dialog");n&&(document.querySelector(t+" figure > img").src=n,document.querySelector(".user-photo > div").classList.add("none")),s.setProfilDialogContent(a,{title:"Mise \xE0 jour",paragraph:o,status:r}),a.showModal()};static displayDialogProfilDeletedDetails=async(e,t)=>{let r=e.status,{message:o}=await e.json(),n=document.querySelector("#data-profil-form > dialog");s.setProfilDialogContent(n,{title:"Compte supprim\xE9",paragraph:o,status:r,handler:t})};static showErrorMsg=async(e,t)=>{let r=e.status,o=t==="/profil"?"profil":"user",{errorMsg:n}=await e.json();s.#e({msg:n+r,dataSet:"error"},o)};static#e=({msg:e,dataSet:t},r)=>{let o=document.querySelector(s.id(r)+" .container"),n=s.getOrCreateElement({parent:o,cssSelector:"p[data-msg-infos]",hmtlTag:"p"});n.dataset.msgInfos=t,n.textContent=e}};export{S as UserFormHelper};
